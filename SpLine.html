<!doctype html>
<html>
<head>
    <title>Spline Test</title>
    <meta charset="utf-8" />
    <style>
        #content {
            position: fixed;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
        }

        #canvas {
            margin: 0;
            padding: 0;
            cursor: none;
        }

        #tool {
            position: fixed;
            right: 20px;
            top: 20px;
        }
    </style>
</head>
<body>
    <div id="content">
        <canvas id="canvas" onclick="addPoint(event)" oncontextmenu="deletePoint(event)" onmousemove="preview(event)" onmousewheel="zoom(event)"></canvas>
    </div>
    <div id="tool">
        <select id="list" title="Select Spline Type" onchange="preview(event)">
            <option value="Segment">Segment (c0)</option>
            <option value="Cubic">Cubic (c0)</option>
            <option value="Bezier">Bezier (c1,fitting)</option>
            <option value="Catmull-Rom" selected>Catmull-Rom (c1)</option>
            <option value="Hermite">Hermite (c1)</option>
            <option value="Lagrange">Lagrange (câˆž)</option>
        </select>
    </div>
    <script>
        var pointlistX = [], pointlistY = [];
        var canvas = document.getElementById("canvas");

        pointlistX = [138.6779485436933, 168.31067737090004, 235.72513545298528, 251.28231808730646, 274.9885011491574, 299.4355024315747, 325.3641401554627, 348.32950499654896, 360.9234147481677, 354.25605076207387, 332.7723223622327, 320.17841261069844, 320.17841261069844, 333.5131405829267, 359.44177830680445, 386.8520524720798, 458.71141987816094, 517.9768775326739, 550.5728792427587, 569.0933347597334, 570.5749712010845, 540.9422423738595, 471.3053296297195, 415.74396307864185, 416.4847812993417, 425.3745999474973, 489.0849669260721, 565.3892436563156, 625.3955195315486, 660.2139759036689, 665.3997034483971, 619.4689737661065, 513.5319682086522, 470.56451140904556, 471.3053296297195, 482.4176029399455, 550.5728792427587, 624.6547013108323, 676.5119767586549, 707.6263420272492, 712.812069571968, 681.6977043033485, 570.5749712010845, 497.233967353591, 445.3766919058968, 440.93178258175135, 507.60542244313876, 545.3871516979514, 595.7627907042681, 627.6179741935744, 614.2832462212773, 573.5382440838049, 526.5693642545089, 451.00590574492605, 370.9975379113052, 290.2205678383551]
        pointlistY = [442.9614502984681, 382.95517442323467, 289.6120786173552, 264.4242591141776, 171.08116330827397, 102.18506878488225, 69.58906707489012, 68.10743063351683, 85.88706792988718, 116.26061497779808, 157.74643533598612, 203.67716501830603, 258.4977133487139, 266.64671377624654, 268.8691684382727, 239.97725783167448, 159.9688899980538, 96.2585230194327, 88.1095225919454, 102.9258870055611, 125.15043362603622, 158.48725355670078, 228.12416630076132, 295.538624382801, 301.4651701482469, 293.316169720755, 235.53234850757514, 174.04443619101832, 120.7055243019117, 130.33616117077855, 165.89543576352006, 212.5669836664461, 303.6876248103258, 334.06117185825997, 342.9509905064583, 354.0632638166745, 319.98562566529296, 280.7222599691738, 247.38544003849177, 259.23853156941715, 289.6120786173552, 319.98562566529296, 387.4000837473489, 428.1450858848215, 480.7431795532375, 505.93099905642555, 508.1534537184577, 500.7452715116415, 517.043272366622, 550.3800922972955, 568.1597295936995, 568.1597295936995, 573.5773096391665, 578.0222189632526, 603.9508566871282, 604.6970658152852]

        function init() {
            resizeCanvas();
            window.onresize = function () {
                resizeCanvas();
            };
            window.onkeydown = function () {
                if (event.keyCode == 13 || event.keyCode == 32) {
                    pointlistX = [], pointlistY = [];
                    resizeCanvas();
                }
            };
        }

        function resizeCanvas() {
            var w = window.innerWidth, h = window.innerHeight;
            w = Math.floor(1 * w), h = Math.floor(1 * h);
            if ((w >= 50) && (h >= 50) &&
                    ((canvas.width !== w) || (canvas.height !== h))) {
                canvas.width = w;
                canvas.height = h;
                canvas.style.width = w + "px";
                canvas.style.height = h + "px";
            }

            redraw();
        }

        function Segment(ctx) {
            var n = pointlistX.length - 1, px = pointlistX.slice(0), py = pointlistY.slice(0);
            ctx.beginPath();
            ctx.moveTo(px[0], py[0]);
            for (var i = 1; i < n; i++) ctx.lineTo(px[i], py[i]);
            ctx.stroke();
        }
        function Bezier(ctx) {
            var C = function C(n, k) {
                if (k > n / 2) k = n - k;
                if (k == 0) return 1;
                var r = 1;
                while (k > 0) r *= n / k, n--, k--;
                return r;
            };
            var n = pointlistX.length - 1, px = pointlistX.slice(0), py = pointlistY.slice(0), s;
            for (k = 0; k <= n; k++) {
                s = C(n, k);
                px[k] *= s, py[k] *= s;
            }
            var t, x, y;
            ctx.beginPath();
            ctx.moveTo(px[0], py[0]);
            var dif = n * 40;
            for (i = 0; i <= dif; i++) {
                t = i / dif;
                x = y = 0;
                for (k = 0; k <= n; k++) {
                    s = Math.pow(t, k) * Math.pow(1 - t, n - k);
                    x += px[k] * s, y += py[k] * s;
                }
                ctx.lineTo(x, y);
            }
            ctx.stroke();
        }
        function Lagrange(ctx) {
            var t, x, y, li;
            var k = pointlistX.length - 1;
            var dif = k * 30;
            ctx.beginPath();
            ctx.moveTo(pointlistX[0], pointlistY[0]);
            for (s = 0; s <= dif; s++) {
                t = s / dif;
                x = y = 0;
                for (i = 0; i <= k; i++) {
                    li = 1;
                    for (m = 0; m <= k; m++) {
                        if (m != i) li *= (k * t - m) / (i - m);
                    }
                    x += pointlistX[i] * li;
                    y += pointlistY[i] * li;
                }
                ctx.lineTo(x, y);
            }
            ctx.stroke();
        }
        function Cubic(ctx) {
            var px = [], py = [];
            var n = pointlistX.length;
            px.push(2 * pointlistX[0] - pointlistX[1]), py.push(2 * pointlistY[0] - pointlistY[1]);
            px = px.concat(pointlistX), py = py.concat(pointlistY);
            px.push(2 * px[n] - px[n - 1]), py.push(2 * py[n] - py[n - 1]);

            var t, x, y;
            for (m = 1; m < n; m++) {
                ctx.beginPath();
                ctx.moveTo(px[m], py[m]);
                for (d = 0; d <= 30; d++) {
                    t = d / 30;
                    x = ((t - 1) * (t - 2) * (3 * px[m] * (t + 1) - px[m - 1] * t) + t * (t + 1) * ((t - 1) * px[m + 2] - 3 * px[m + 1] * (t - 2))) / 6;
                    y = ((t - 1) * (t - 2) * (3 * py[m] * (t + 1) - py[m - 1] * t) + t * (t + 1) * ((t - 1) * py[m + 2] - 3 * py[m + 1] * (t - 2))) / 6;
                    ctx.lineTo(x, y);
                }
                ctx.stroke();
            }
        }
        function Catmull_Rom(ctx) {
            var px = [], py = [];
            var n = pointlistX.length;
            px.push(2 * pointlistX[0] - pointlistX[1]), py.push(2 * pointlistY[0] - pointlistY[1]);
            px = px.concat(pointlistX), py = py.concat(pointlistY);
            px.push(2 * px[n] - px[n - 1]), py.push(2 * py[n] - py[n - 1]);
            n--;

            var t, t2, t3, x, y, C0, C1, C2, C3;

            for (m = 0; m < n; m++) {
                ctx.beginPath();
                ctx.moveTo(px[m + 1], py[m + 1]);
                for (d = 0; d <= 60; d++) {
                    t = d / 60;
                    t2 = t * t, t3 = t2 * t;
                    C0 = -0.5 * t3 + t2 - 0.5 * t, C1 = 1.5 * t3 - 2.5 * t2 + 1, C2 = -1.5 * t3 + 2 * t2 + 0.5 * t, C3 = 0.5 * t3 - 0.5 * t2;
                    x = C0 * px[m] + C1 * px[m + 1] + C2 * px[m + 2] + C3 * px[m + 3];
                    y = C0 * py[m] + C1 * py[m + 1] + C2 * py[m + 2] + C3 * py[m + 3];
                    ctx.lineTo(x, y);
                }
                ctx.stroke();
            }
        }
        function Hermite(ctx) {
            var n = pointlistX.length - 1, px = pointlistX.slice(0), py = pointlistY.slice(0);

        }

        function redraw() {
            var ctx = canvas.getContext("2d");
            ctx.fillStyle = "rgb(12,12,12)";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            var l = pointlistX.length;
            ctx.beginPath();
            ctx.strokeStyle = "Orange";
            ctx.lineWidth = 0.6;
            ctx.setLineDash([5, 10]);
            ctx.moveTo(pointlistX[0], pointlistY[0]);
            for (i = 1; i < l; i++) {
                ctx.lineTo(pointlistX[i], pointlistY[i]);
            }
            ctx.stroke();

            ctx.beginPath();
            ctx.setLineDash([]);
            ctx.lineWidth = 1;
            if (l > 1) {
                ctx.strokeStyle = "Lime";
                switch (document.getElementById("list").value) {
                    case "Segment": {
                        Segment(ctx); break;
                    }
                    case "Cubic": {
                        Cubic(ctx); break;
                    }
                    case "Bezier": {
                        Bezier(ctx); break;
                    }
                    case "Catmull-Rom": {
                        Catmull_Rom(ctx); break;
                    }
                    case "Lagrange": {
                        Lagrange(ctx); break;
                    }
                }
            }

            var dot = function dot(x, y, r) {
                ctx.beginPath();
                ctx.moveTo(x - r, y);
                ctx.lineTo(x + r, y);
                ctx.moveTo(x, y - r);
                ctx.lineTo(x, y + r);
                ctx.stroke();
            }
            ctx.strokeStyle = "Magenta";
            ctx.lineWidth = 2;
            for (var i = 0; i < l; i++) {
                dot(pointlistX[i], pointlistY[i], 6);
                if (i == 0) ctx.strokeStyle = "RoyalBlue";
            }
        }

        function preview(event) {
            event.preventDefault();
            var x = event.clientX, y = event.clientY;
            pointlistX.push(x), pointlistY.push(y);
            redraw();
            pointlistX.pop(), pointlistY.pop();

            var ctx = canvas.getContext("2d");
            ctx.strokeStyle = "OrangeRed";
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(x - 12, y);
            ctx.lineTo(x + 12, y);
            ctx.moveTo(x, y - 12);
            ctx.lineTo(x, y + 12);
            ctx.stroke();
        }

        function addPoint(event) {
            var x = event.clientX, y = event.clientY;
            pointlistX.push(x), pointlistY.push(y);
            preview(event);
        }

        function deletePoint(event) {
            pointlistX.pop(), pointlistY.pop();
            preview(event);
        }

        function zoom(event) {
            var x = event.clientX, y = event.clientY, d = Math.exp(0.001 * event.wheelDelta);
            var l = pointlistX.length;
            for (i = 0; i < l; i++) {
                pointlistX[i] -= x, pointlistY[i] -= y;
                pointlistX[i] *= d, pointlistY[i] *= d;
                pointlistX[i] += x, pointlistY[i] += y;
            }
            preview(event);
        }

        // http://www.cnblogs.com/WhyEngine/p/4020294.html

        init();
    </script>
</body>
</html>


